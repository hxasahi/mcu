C51 COMPILER V9.01   MUSICTEST_2                                                           03/02/2020 17:03:47 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MUSICTEST_2
OBJECT MODULE PLACED IN musictest_2.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE musictest_2.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************与飞电子开发板例程************************
   2          *  名称：本程序为蜂鸣器的基本驱动示例，
   3              首先 用杜邦线 将单片机的P23口与电机驱动电路的 J1 (FM)插针相连
   4               实验板唱歌实验
   5          *  公司：与飞电子
   6          *  淘宝：http://yfmcu.taobao.com       
   7          *  编写：与飞
   8          *  日期：2013-1-4
   9          *   QQ : 112990183
  10          *  晶振:11.0592MHZ
  11          *  说明：免费开源，不提供源代码分析
  12          ******************************************************************/
  13          
  14          #include <at89x52.h>
  15          #define uchar unsigned char
  16          bit flag; //标志音乐输出脚电平的高低
  17          uchar ptr = 0; //取音符
  18          uchar high; //计数器高位
  19          uchar low; //计数器低位
  20          // 本曲谱为 "music_test-这就是爱吗",前两个十六进制表示发声频率,后一个表示发声时间,255,255 表示休止符
  21          // 0x00 表示结束
  22          uchar code music[] = {
  23          246,209,255,249,30,127,249,197,127,250,137,127,249,197,127,250,137,127,249,30,127,249,197,255,255,255,255,
  24          249,30,127,248,182,127,249,30,127,247,209,127,248,182,255,255,255,255,247,209,127,248,182,127,249,30,127,2
             -51,233,64,251,104,364,246,
  25          209,127,249,30,127,249,197,127,250,137,127,250,216,127,250,137,127,251,233,127,250,137,64,249,197,64,249,1
             -97,255,249,30,127,249,197,
  26          127,250,137,127,249,197,127,250,137,127,251,104,64,249,197,64,249,197,255,255,255,255,249,30,127,249,197,1
             -27,250,137,127,252,143,127,
  27          252,91,127,251,104,127,251,104,255,251,233,255,251,104,127,250,216,127,251,104,127,249,30,127,249,30,255,2
             -50,216,255,255,255,127,249,
  28          30,255,249,30,127,248,182,127,247,209,127,248,182,127,249,30,255,255,255,255,255,255,255,250,137,127,250,1
             -37,127,251,233,127,251,233,
  29          127,250,137,127,250,137,127,249,197,127,249,197,127,249,197,127,251,104,127,251,104,127,248,182,127,249,19
             -7,127,249,30,127,249,30,127,
  30          249,30,127,252,143,127,252,143,127,252,91,127,251,233,127,251,104,64,251,104,64,250,137,127,250,216,127,25
             -1,104,255,255,255,255,
  31          250,137,127,250,137,127,251,233,127,251,233,127,250,137,127,250,137,127,249,197,127,249,197,127,252,91,127
             -,252,91,64,252,91,64,252,
  32          91,127,251,233,127,251,233,127,251,104,127,250,137,127,249,197,64,249,30,64,249,30,255,255,255,255,249,30,
             -64,249,197,64,250,137,127,250,
  33          216,64,250,137,64,                                                                                                                                                                                         
  34          0//结束
  35          };
  36          
  37          void Init(void); //初始化函数
  38          void DelayMs(unsigned int time); //毫秒级延时函数
  39          
  40          void main()
  41          {
  42   1              uchar time;
  43   1              Init();
  44   1              TH0 = high;
  45   1              TL0 = low;
  46   1              while (1)
C51 COMPILER V9.01   MUSICTEST_2                                                           03/02/2020 17:03:47 PAGE 2   

  47   1              {
  48   2                      if (music[ptr] != 255 && music[ptr] != 0)//判断是否是正常音符
  49   2                      {
  50   3                              TR0 = 0;
  51   3                              P2_3 = 1;
  52   3                              DelayMs(10); //间歇
  53   3                              TR0 = 1;
  54   3                              high = music[ptr]; //取设置频率数值的高8 位
  55   3                              low = music[ptr + 1]; //取设置频率数值的低8 位
  56   3                              time = music[ptr + 2]; //取发声时间
  57   3                              P1=0x00;
  58   3                              DelayMs(time);
  59   3                              P1=0xff;
  60   3                              ptr += 3;
  61   3                      }
  62   2                      else if (music[ptr] == 255) //判断是否是休止符
  63   2                      {
  64   3                              time = music[ptr + 2];
  65   3                              DelayMs(time);
  66   3                              ptr += 3;
  67   3                      }
  68   2                      
  69   2                      else //结束符,停止2 秒后继续
  70   2                      {
  71   3                              TR0 = 0;
  72   3                              P2_3 = 1;
  73   3                              DelayMs(2000);
  74   3                              ptr = 0;
  75   3                      }
  76   2              }
  77   1      }
  78          /*********************************************************************************
  79          * 名称：Count1(void) interrupt 1
  80          * 功能：设置计时器0 溢出中断,每中断一次改变P2_3 引脚电平
  81          *********************************************************************************/
  82          void Count1(void) interrupt 1
  83          {
  84   1              TH0 = high;
  85   1              TL0 = low;
  86   1              if (flag == 0) //改变P2_3 引脚电平
  87   1              {
  88   2                      P2_3 = 0;
  89   2                      flag = 1;
  90   2              }
  91   1              else
  92   1              {
  93   2                      P2_3 = 1;
  94   2                      flag = 0;
  95   2              }
  96   1      }
  97          /*********************************************************************************
  98          * 名称：Init()
  99          * 功能：设置计数器0 工作方式,16 位计数,溢出中断方式
 100          **********************************************************************************/
 101          void Init()
 102          {
 103   1              TMOD = 0x01; //定时器0 处于计时方式,16 位
 104   1              EA = 1;
 105   1              ET0 = 1; //定时器0 溢出中断
 106   1      }
 107          /*********************************************************************************
 108          * 名称：DelayMs(unsigned int time)
C51 COMPILER V9.01   MUSICTEST_2                                                           03/02/2020 17:03:47 PAGE 3   

 109          * 功能：延时time * 1ms 时间
 110          *********************************************************************************/
 111          void DelayMs(unsigned int time)
 112          {
 113   1              unsigned int i;
 114   1              unsigned int j;
 115   1              for (j =0; j < time; j++) //每个循环 约 3ms
 116   1              {
 117   2                      for (i =0; i < 363; i++)
 118   2                      {;}
 119   2              }
 120   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    175    ----
   CONSTANT SIZE    =    340    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
